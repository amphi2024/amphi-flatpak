app-id: com.amphi.notes
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: notes

finish-args:
  - --share=network
  - --filesystem=home
  - --env=LD_LIBRARY_PATH=/app/bin/lib:$LD_LIBRARY_PATH
  - --socket=x11
  - --socket=wayland
  - --talk-name=org.freedesktop.portal.Desktop

modules:

  - name: notes
    buildsystem: simple
    build-commands:
      - tar --use-compress-program=unzstd -xf notes.tar.zst
      - install -Dm755 notes /app/bin/notes
      - cp -r lib /app/bin/lib
      - cp -r data /app/bin/data
      - cp -r external/* /app/bin/lib/

      - install -Dm644 com.amphi.notes.desktop /app/share/applications/com.amphi.notes.desktop
      - install -Dm644 icon.svg /app/share/icons/hicolor/128x128/apps/com.amphi.notes.svg
    
    sources:
      - type: file
        dest-filename: notes.tar.zst
        only-arches: [x86_64]
        url: https://amphi.site/releases/notes/notes-linux-x64-1.1.0.tar.zst
        sha256: bae2fcd1a99578c13adac6e7a4ef282b14960dafda65e81b37fd42eea08a7938

      - type: file
        dest-filename: notes.tar.zst
        only-arches: [aarch64]
        url: https://amphi.site/releases/notes/notes-linux-arm64-1.1.0.tar.zst
        sha256: 546d6e19a7d514fa2623c5ebc35a24890f5c26ca7581bd3cc0b96fc9b9dadd47

      - type: file
        path: com.amphi.notes.metainfo.xml
      - type: file
        path: com.amphi.notes.desktop
      - type: file
        path: icon.svg

      - type: dir
        dest: external
        path: external_x64
        only-arches: [x86_64]

      - type: dir
        dest: external
        path: external_arm64
        only-arches: [aarch64]
